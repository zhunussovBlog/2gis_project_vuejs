(function(t){function e(e){for(var n,r,s=e[0],c=e[1],l=e[2],p=0,d=[];p<s.length;p++)r=s[p],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&d.push(a[r][0]),a[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);u&&u(e);while(d.length)d.shift()();return i.push.apply(i,l||[]),o()}function o(){for(var t,e=0;e<i.length;e++){for(var o=i[e],n=!0,s=1;s<o.length;s++){var c=o[s];0!==a[c]&&(n=!1)}n&&(i.splice(e--,1),t=r(r.s=o[0]))}return t}var n={},a={app:0},i=[];function r(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=n,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;i.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("56d7")},"0dfd":function(t,e,o){},"56d7":function(t,e,o){"use strict";o.r(e);o("e260"),o("e6cf"),o("cca6"),o("a79d"),o("db4d");var n=o("2b0e"),a=o("ecee"),i=o("c074"),r=o("ad3d"),s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-app",[o("v-content",{staticClass:"d-flex align-center",staticStyle:{"max-height":"100vh",overflow:"hidden"}},[o("v-card",{staticClass:"bar pb-7 pt-3 px-2 text-center",attrs:{elevation:"3","max-width":"768"}},[o("div",{staticClass:"inputRow d-flex flex-row align-center"},[o("label",{staticClass:"pointLabel",attrs:{for:"point_a"}},[t._v("А")]),o("v-input",{staticClass:"pointInput",attrs:{point:"a",map:t.map,layer:t.layerA,getPosition:t.getPosition,deleteMarker:t.deleteMarker,name:"point_a"}})],1),o("div",{staticClass:"inputRow d-flex mb-2 flex-row align-center"},[o("label",{staticClass:"pointLabel",attrs:{for:"point_a"}},[t._v("Б")]),o("v-input",{staticClass:"pointInput",attrs:{point:"b",map:t.map,layer:t.layerB,getPosition:t.getPosition,deleteMarker:t.deleteMarker,name:"point_b"}})],1),o("v-btn",{attrs:{small:"",absolute:"",fab:"",left:"",elevation:"4",color:"primary"},on:{click:function(e){return t.getPosition("")}}},[o("v-icon",{attrs:{color:"white"}},[t._v("mdi-map-marker")])],1),o("v-btn",{staticStyle:{left:"50%",transform:"translateX(-100%)"},attrs:{small:"",fab:"",absolute:"",elevation:"4",color:"primary"},on:{click:t.toggleCard}},[o("v-icon",{attrs:{color:"white",id:"cardBtn"}},[t._v("mdi-arrow-up")])],1),o("v-btn",{staticClass:"route",attrs:{large:"",absolute:"",right:"",elevation:"4",color:"success"},on:{click:t.getRouteData}},[t._v("В путь")])],1),o("v-card",{staticClass:"mx-auto map",attrs:{id:"map","max-width":"768"}})],1),o("v-footer",{staticClass:"myFooter mx-auto pb-3 pt-3 primary",attrs:{app:"",fixed:"","max-width":"768",elevation:"25"}},[o("v-card",{staticClass:"px-2 py-2 text-center",staticStyle:{"border-radius":"0"},attrs:{width:"50%"}},[o("span",{staticClass:"headline font-weight-bold primary--text"},[t._v("Счетчик")])]),o("v-card",{staticClass:"px-2 py-2 text-center",staticStyle:{"border-radius":"0"},attrs:{width:"50%"}},[o("span",{staticClass:"headline font-weight-medium primary--text"},[t._v(t._s(t.counter)+" км.")])])],1)],1)},c=[],l=(o("99af"),o("4160"),o("d81d"),o("b0c0"),o("b680"),o("159b"),o("2909")),u=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("v-autocomplete",{staticClass:"mx-4",attrs:{loading:t.loading,items:t.items,"search-input":t.search,"cache-items":"",flat:"","hide-no-data":"",clearable:"","hide-details":"",label:"a"===t.point?"Пункт отправления":"Пункт назначения","solo-inverted":"",required:"","return-object":""},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e},input:function(e){t.select&&t.submitAddress(t.select)}},model:{value:t.select,callback:function(e){t.select=e},expression:"select"}})],1)},p=[],d=(o("4de4"),o("c975"),o("ac1f"),o("841c"),{name:"Input",props:["point","map","layer","getPosition","deleteMarker"],data:function(){return{select:null,loading:!1,search:null,items:[{text:"Мое местоположение",id:1}],result:[]}},mounted:function(){var t=this;this.$store.watch((function(e,o){return o["getList".concat(t.point.toUpperCase())]}),(function(e){var o;e&&(t.result=(o=t.result).concat.apply(o,Object(l["a"])(e)))})),this.$store.watch((function(e,o){return o["getPointData".concat(t.point.toUpperCase())]}),(function(e,o){o||"Мое местоположение"!==e.name||(t.select=t.items[0])}))},watch:{layer:function(){this.layer||(this.search=null,this.select=null)},search:function(t){t&&t!==this.select&&this.querySelections(t)},select:function(){this.select&&""!==this.select||this.deleteMarker(this.point)}},methods:{querySelections:function(t){var e=this;this.loading=!0,this.$store.dispatch("allList",{input:t,region_id:this.$store.getters.getRegionId,point:this.point}),setTimeout((function(){e.items=e.result.filter((function(e){return(e.text||"").toLowerCase().indexOf((t||"").toLowerCase())>-1})),e.loading=!1}),500)},submitAddress:function(t){"Мое местоположение"===t.text?this.getPosition(this.point):t.id&&this.$store.dispatch("setPoint",{id:t.id,point:this.point})}}}),h=d,f=o("2877"),g=o("6544"),m=o.n(g),v=o("c6a6"),y=Object(f["a"])(h,u,p,!1,null,"d95ec50e",null),b=y.exports;m()(y,{VAutocomplete:v["a"]});var w={name:"App",components:{vInput:b},data:function(){return{map:null,layerA:null,layerB:null,layerRoute:null,layerUser:null,watchID:null,prevDistance:null,counter:0}},mounted:function(){var t=this;this.setMap(),this.getPosition("a"),this.$store.watch((function(t,e){return e.getCurrentPosition}),(function(e,o){!o&&e?(t.$store.dispatch("setRegionId",{point:"".concat(e.position[1],", ").concat(e.position[0])}),t.$store.dispatch("setEachPoint",{whichPoint:e.point,point:Object(l["a"])(e.position).reverse()}),t.$store.dispatch("setEachDataPoint",{name:"Мое местоположение",whichPoint:e.point,point:Object(l["a"])(e.position).reverse()})):o&&e.point?(t.$store.dispatch("setEachPoint",{whichPoint:e.point,point:Object(l["a"])(e.position).reverse()}),t.$store.dispatch("setEachDataPoint",{name:"Мое местоположение",whichPoint:e.point,point:Object(l["a"])(e.position).reverse()})):o&&""===e.point&&(t.layerUser||t.setUserMarker(e.position),t.setViewMarker(e.position,12)),e&&(t.layerUser?t.moveUserMarker(new DG.latLng(e.position)):t.setUserMarker(e.position))})),this.$store.watch((function(t,e){return e.getPointDataA}),(function(e){if(e){var o=[e.point[0],e.point[1]].reverse(),n="Пункт Отправления";if(t.equalAddress("b",e),t.setMarker(o,n,"".concat(e.name," - ").concat(n),"a"),t.setViewMarker(o,15),t.layerRoute){t.layerRoute.remove(),t.watchID&&t.counterID&&(navigator.geolocation.clearWatch(t.watchID),t.watchID=null);var a=t.$store.getters.getPointB,i=[a[0],a[1]].reverse(),r="Пункт назначения",s=t.$store.getters.getPointDataB;t.setMarker(i,r,"".concat(s.name," - ").concat(r),"b")}}})),this.$store.watch((function(t,e){return e.getPointDataB}),(function(e){if(e){var o=[e.point[0],e.point[1]].reverse(),n="Пункт назначения";if(t.equalAddress("a",e),t.setMarker(o,n,"".concat(e.name," - ").concat(n),"b"),t.setViewMarker(o,15),t.layerRoute){t.layerRoute.remove(),t.watchID&&t.counterID&&(navigator.geolocation.clearWatch(t.watchID),t.watchID=null);var a=t.$store.getters.getPointA,i=[a[0],a[1]].reverse(),r="Пункт отправления",s=t.$store.getters.getPointDataA;t.setMarker(i,r,"".concat(s.name," - ").concat(r),"a")}}})),this.$store.watch((function(t,e){return e.getRegionId}),(function(e){e&&t.$store.dispatch("setCityName",{id:e})})),this.$store.watch((function(t,e){return e.getRouteData}),(function(e){e&&(t.displayRoute(e),t.watchPosition(),t.toggleCard(document.querySelector("#cardBtn")))}))},methods:{equalAddress:function(t,e){var o=t.toUpperCase();this["layer".concat(o)]&&this.$store.getters["getPointData".concat(o)]&&this.$store.getters["getPointData".concat(o)].name===e.name&&(this.deleteMarker(t),this["layer".concat(o)]=null,this.$store.dispatch("setEachDataPoint",{whichPoint:t,name:null,point:null}),this.$store.dispatch("setEachPoint",{whichPoint:t,point:null}))},setMap:function(){this.map=DG.map("map",{center:[43.238949,76.889709],zoom:12,zoomControl:!1,fullscreenControl:!1,minZoom:8})},getPosition:function(t){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(o){var n=o.coords.latitude,a=o.coords.longitude;e.$store.dispatch("setCurrentPosition",{position:[n,a],point:t})}))},watchPosition:function(){var t=this;navigator.geolocation&&(this.watchID=navigator.geolocation.watchPosition((function(e){var o=e.coords.latitude,n=e.coords.longitude;t.$store.dispatch("setCurrentPosition",{position:[o,n],point:null}),t.updateCounter(t.$store.getters.getPointA,{position:[o,n]})}),null,{enableHighAccuracy:!0,timeout:200}))},updateCounter:function(t,e){var o=this.getDistance(t,e);this.prevDistance?(this.counter+=Math.abs(o-this.prevDistance),this.prevDistance=o):(this.prevDistance=o,this.counter=0)},getDistance:function(t,e){if(t&&e.position){var o=e.position;o=[o[0],o[1]];var n=[t[0],t[1]].reverse(),a=DG.latLng(o),i=DG.latLng(n),r=i.distanceTo(a);return+(Math.floor(r/1e3*100)/100).toFixed(2)}return 0},setMarker:function(t,e,o,n){this.deleteMarker(n),this["layer".concat(n.toUpperCase())]=DG.marker(t,{title:e}).addTo(this.map).bindPopup(o)},deleteMarker:function(t){this["layer".concat(t.toUpperCase())]&&this["layer".concat(t.toUpperCase())].remove()},setViewMarker:function(t,e){this.map.setView(t,e)},moveUserMarker:function(t){this.layerUser.setLatLng(t)},setUserMarker:function(t){var e=DG.divIcon({html:'<div style="width: 50px; height: 50px; border-radius: 50%;background: rgba(15, 110, 193, 0.31);transform: translate(-30%, -30%); position: relative"><div style="width: 23px; height: 23px; border-radius: 13px; background: #fff;border: 2px solid #0f6ec1; position: absolute;top: 50%; left: 50%;transform: translate(-50%, -50%)"><img src="./img/car.png" width="12" style="position: absolute; top: 50%; left: 50%;transform: translate(-50%, -50%)" alt="M"></div></div>',className:"user-icon"});this.layerUser&&this.layerUser.remove(),this.layerUser=DG.marker([t[0],t[1]],{icon:e}).addTo(this.map).bindPopup("Вы здесь")},getRouteData:function(){var t=this.$store.getters.getPointA,e=this.$store.getters.getPointB;if(t&&e){var o=this.$store.getters.getPointDataA.name,n=this.$store.getters.getPointDataB.name;this.$store.dispatch("setRouteData",{city:this.$store.getters.getCityName,pointNameA:o,pointNameB:n,pointA:t,pointB:e}),this.startDistance=this.getDistance(this.$store.getters.getCurrentPosition,e)}},createIconPoint:function(t){var e="a"===t?"А":"Б";return DG.divIcon({html:'<div style="width: 20px; height: 20px; border-radius: 13px; background: #0f6ec1;border: 3px solid #fff; transform: translate(-3px, -3px); position: relative"><span style="position: absolute; top: 50%; left: 50%;transform: translate(-45%, -45%); font-family: sans-serif;'+'font-weight: 700; color: #fff; font-size: 10px;">'.concat(e)+"</span></div>",className:"my-point"})},displayRoute:function(t){var e={ignore:"#0f6ec1",pedestrian:"#626262",normal:"#ffc402","no-traffic":"#22aa01",fast:"#22aa01",slow:"#ed2301","slow-jams":"#851705"},o=5,n=DG.layerGroup(),a=DG.layerGroup(),i=DG.layerGroup(),r=DG.layerGroup(),s=t,c=this.createIconPoint("a"),l=this.createIconPoint("b"),u=s.waypoints[0],p=s.waypoints[1];DG.marker([u.projected_point.lat,u.projected_point.lon],{icon:c}).addTo(r),DG.marker([p.projected_point.lat,p.projected_point.lon],{icon:l}).addTo(r),this.layerA.remove(),this.layerB.remove(),s.begin_pedestrian_path&&(DG.Wkt.geoJsonLayer(s.begin_pedestrian_path.geometry.selection,{style:function(){return{color:"#ffffff",weight:8}}}).addTo(a),DG.Wkt.geoJsonLayer(s.begin_pedestrian_path.geometry.selection,{style:function(){return{color:e.pedestrian,weight:o}}}).addTo(r)),s.end_pedestrian_path&&(DG.Wkt.geoJsonLayer(s.end_pedestrian_path.geometry.selection,{style:function(){return{color:"#ffffff",weight:8}}}).addTo(a),DG.Wkt.geoJsonLayer(s.end_pedestrian_path.geometry.selection,{style:function(){return{color:e.pedestrian,weight:o}}}).addTo(r)),s.maneuvers.forEach((function(t){t.outcoming_path&&t.outcoming_path.geometry.forEach((function(t){DG.Wkt.geoJsonLayer(t.selection,{style:function(){return{color:"#000",weight:11}}}).addTo(i),DG.Wkt.geoJsonLayer(t.selection,{style:function(){return{color:"#ffffff",weight:10}}}).addTo(a),DG.Wkt.geoJsonLayer(t.selection,{style:function(){return{color:e[t.color],weight:o}}}).addTo(r)}))})),i.addTo(n),a.addTo(n),r.addTo(n),this.layerRoute=n,this.layerRoute.addTo(this.map)},toggleCard:function(t){var e=null;t.target?t.target.classList.contains("v-icon")?e=t.target:t.target.classList.contains("v-btn__content")?e=t.target.firstElementChild:t.target.classList.contains("v-btn")&&(e=t.target.firstElementChild.firstElementChild):e=t,this.toggle(e,"bar")},toggle:function(t,e){t.closest(".".concat(e)).classList.contains("active")?(t.classList.remove("mdi-arrow-down"),t.classList.add("mdi-arrow-up"),t.closest(".".concat(e)).classList.remove("active")):(t.classList.remove("mdi-arrow-up"),t.classList.add("mdi-arrow-down"),t.closest(".".concat(e)).classList.add("active"))}}},P=w,D=(o("8be1"),o("7496")),k=o("8336"),C=o("b0af"),_=o("a75b"),x=o("553a"),A=o("132d"),$=o("b675"),L=Object(f["a"])(P,s,c,!1,null,"6bfbb556",null),I=L.exports;m()(L,{VApp:D["a"],VBtn:k["a"],VCard:C["a"],VContent:_["a"],VFooter:x["a"],VIcon:A["a"],VInput:$["a"]});var G=o("f309");n["a"].use(G["a"]);var M=new G["a"]({}),B=o("2f62"),j=o("bc3a"),R=o.n(j),U={state:{listA:[],listB:[]},getters:{getListA:function(t){return t.listA},getListB:function(t){return t.listB}},mutations:{updateListA:function(t,e){t.listA=e},updateListB:function(t,e){t.listB=e}},actions:{allList:function(t,e){R.a.get("https://catalog.api.2gis.ru/2.0/geo/search",{headers:{Accept:"application/json"},params:{key:t.rootState.key,q:e.input,region_id:e.region_id}}).then((function(o){var n=[];200===o.data.meta.code&&(n=o.data.result.items.filter((function(t){return t.id})).map((function(t){return{id:t.id,text:t.name}}))),t.commit("updateList".concat(e.point.toUpperCase()),n)}))}}},O=(o("466d"),{state:{pointA:null,pointB:null,pointDataA:null,pointDataB:null},getters:{getPointA:function(t){return t.pointA},getPointB:function(t){return t.pointB},getPointDataA:function(t){return t.pointDataA},getPointDataB:function(t){return t.pointDataB}},mutations:{updatePointA:function(t,e){t.pointA=e},updatePointB:function(t,e){t.pointB=e},updatePointDataA:function(t,e){t.pointDataA=e},updatePointDataB:function(t,e){t.pointDataB=e}},actions:{setPoint:function(t,e){R.a.get("https://catalog.api.2gis.ru/2.0/geo/get",{headers:{Accept:"application/json"},params:{key:t.rootState.key,id:e.id,fields:"items.geometry.selection"}}).then((function(o){if(200===o.data.meta.code){var n=/[+-]?\d+(\.\d+)?/g,a=o.data.result.items[0].geometry.selection;a=a.match(n).map((function(t){return parseFloat(t)})),a.length>2&&(a=[a[0],a[1]]);var i=o.data.result.items[0];t.commit("updatePointData".concat(e.point.toUpperCase()),{name:i.name,point:a}),t.commit("updatePoint".concat(e.point.toUpperCase()),a)}}))},setEachPoint:function(t,e){e.point?t.commit("updatePoint".concat(e.whichPoint.toUpperCase()),e.point):t.commit("updatePoint".concat(e.whichPoint.toUpperCase()),null)},setEachDataPoint:function(t,e){e.point||e.name?t.commit("updatePointData".concat(e.whichPoint.toUpperCase()),{name:e.name,point:e.point}):t.commit("updatePointData".concat(e.whichPoint.toUpperCase()),null)}}}),T=(o("7db0"),o("974a")),S={state:{regionId:null,isGlobal:null,regions:null,cityName:null},getters:{getRegionId:function(t){return t.regionId},isGlobal:function(t){return t.isGlobal},getRegions:function(t){return t.regions},getCityName:function(t){return t.cityName}},mutations:{updateRegionId:function(t,e){t.regionId=e},updateRegions:function(t,e){t.regions=e},updateCityName:function(t,e){t.cityName=e},updateIsGlobal:function(t,e){t.isGlobal=e}},actions:{setRegionId:function(t,e){R.a.get("https://catalog.api.2gis.ru/2.0/geo/search",{headers:{Accept:"application/json"},params:{key:t.rootState.key,point:e.point,fields:"items.region_id",radius:2e3}}).then((function(e){if(200===e.data.meta.code){var o=e.data.result.items.find((function(t){return t.region_id})),n=o.region_id;t.commit("updateRegionId",n)}else t.commit("updateIsGlobal",!0)}))},allRegions:function(t){R.a.get("https://catalog.api.2gis.ru/2.0/region/list",{headers:{Accept:"application/json"},params:{key:t.rootState.key}}).then((function(e){200===e.data.meta.code&&t.commit("updateRegions",e.data.result.items)}))},setCityName:function(t,e){R.a.get("https://catalog.api.2gis.ru/2.0/region/get",{headers:{Accept:"application/json"},params:{key:t.rootState.key,id:e.id}}).then((function(e){if(200===e.data.meta.code){var o=e.data.result.items[0].name.toLowerCase();t.commit("updateCityName",Object(T["transliterate"])(o))}}))}}},E={state:{routeData:null},getters:{getRouteData:function(t){return t.routeData}},mutations:{updateRouteData:function(t,e){t.routeData=e}},actions:{setRouteData:function(t,e){var o={locale:"ru",point_a_name:e.pointNameA,point_b_name:e.pointNameB,points:[{type:"pedo",x:e.pointA[0],y:e.pointA[1]},{type:"pedo",x:e.pointB[0],y:e.pointB[1]}],type:"jam"};R.a.post("https://catalog.api.2gis.ru/carrouting/4.0.0/".concat(e.city,"/"),o,{headers:{Accept:"application/json"},params:{key:t.rootState.key}}).then((function(e){e.data&&t.commit("updateRouteData",e.data.result[0])}))}}},N={state:{currentPosition:null},getters:{getCurrentPosition:function(t){return t.currentPosition}},mutations:{updateCurrentPosition:function(t,e){t.currentPosition=e}},actions:{setCurrentPosition:function(t,e){t.commit("updateCurrentPosition",e)}}};n["a"].use(B["a"]);var V=new B["a"].Store({state:{key:"ruzrgk1901"},modules:{search:U,point:O,region:S,route:E,position:N}}),J=o("194a");a["c"].add(i["a"]),n["a"].component("font-awesome-icon",r["a"]),n["a"].config.productionTip=!1,new n["a"]({vuetify:M,DG:J,render:function(t){return t(I)},store:V}).$mount("#app")},"8be1":function(t,e,o){"use strict";var n=o("0dfd"),a=o.n(n);a.a}});
//# sourceMappingURL=app-legacy.93390ae1.js.map