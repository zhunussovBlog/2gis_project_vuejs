(function(t){function e(e){for(var i,r,n=e[0],c=e[1],l=e[2],d=0,h=[];d<n.length;d++)r=n[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&h.push(o[r][0]),o[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);p&&p(e);while(h.length)h.shift()();return s.push.apply(s,l||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],i=!0,n=1;n<a.length;n++){var c=a[n];0!==o[c]&&(i=!1)}i&&(s.splice(e--,1),t=r(r.s=a[0]))}return t}var i={},o={app:0},s=[];function r(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=i,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(a,i,function(e){return t[e]}.bind(null,i));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],c=n.push.bind(n);n.push=e,n=n.slice();for(var l=0;l<n.length;l++)e(n[l]);var p=c;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"0dfd":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("db4d");var i=a("2b0e"),o=a("ecee"),s=a("c074"),r=a("ad3d"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",[a("v-content",{staticClass:"d-flex align-center",staticStyle:{"max-height":"100vh",overflow:"hidden"}},[a("v-card",{staticClass:"bar pb-7 pt-3 px-2 text-center",attrs:{elevation:"3","max-width":"768"}},[a("div",{staticClass:"inputRow d-flex flex-row align-center"},[a("label",{staticClass:"pointLabel",attrs:{for:"point_a"}},[t._v("А")]),a("v-input",{staticClass:"pointInput",attrs:{point:"a",map:t.map,layer:t.layerA,getPosition:t.getPosition,deleteMarker:t.deleteMarker,name:"point_a"}})],1),a("div",{staticClass:"inputRow d-flex mb-2 flex-row align-center"},[a("label",{staticClass:"pointLabel",attrs:{for:"point_a"}},[t._v("Б")]),a("v-input",{staticClass:"pointInput",attrs:{point:"b",map:t.map,layer:t.layerB,getPosition:t.getPosition,deleteMarker:t.deleteMarker,name:"point_b"}})],1),a("v-btn",{attrs:{small:"",absolute:"",fab:"",left:"",elevation:"4",color:"primary"},on:{click:function(e){return t.getPosition("")}}},[a("v-icon",{attrs:{color:"white"}},[t._v("mdi-map-marker")])],1),a("v-btn",{staticStyle:{left:"50%",transform:"translateX(-100%)"},attrs:{small:"",fab:"",absolute:"",elevation:"4",color:"primary"},on:{click:t.toggleCard}},[a("v-icon",{attrs:{color:"white",id:"cardBtn"}},[t._v("mdi-arrow-up")])],1),a("v-btn",{staticClass:"route",attrs:{large:"",absolute:"",right:"",elevation:"4",color:"success"},on:{click:t.getRouteData}},[t._v("В путь")])],1),a("v-card",{staticClass:"mx-auto map",attrs:{id:"map","max-width":"768"}})],1),a("v-footer",{staticClass:"myFooter mx-auto pb-3 pt-3 primary",attrs:{app:"",fixed:"","max-width":"768",elevation:"25"}},[a("v-card",{staticClass:"px-2 py-2 text-center",staticStyle:{"border-radius":"0"},attrs:{width:"50%"}},[a("span",{staticClass:"headline font-weight-bold primary--text"},[t._v("Счетчик")])]),a("v-card",{staticClass:"px-2 py-2 text-center",staticStyle:{"border-radius":"0"},attrs:{width:"50%"}},[a("span",{staticClass:"headline font-weight-medium primary--text"},[t._v(t._s(t.counter)+" км.")])])],1)],1)},c=[],l=(a("e260"),a("26e9"),a("b680"),a("ddb0"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-autocomplete",{staticClass:"mx-4",attrs:{loading:t.loading,items:t.items,"search-input":t.search,"cache-items":"",flat:"","hide-no-data":"",clearable:"","hide-details":"",label:"a"===t.point?"Пункт отправления":"Пункт назначения","solo-inverted":"",required:"","return-object":""},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e},input:function(e){t.select&&t.submitAddress(t.select)}},model:{value:t.select,callback:function(e){t.select=e},expression:"select"}})],1)}),p=[],d=(a("c975"),a("841c"),{name:"Input",props:["point","map","layer","getPosition","deleteMarker"],data:()=>({select:null,loading:!1,search:null,items:[{text:"Мое местоположение",id:1}],result:[]}),mounted(){this.$store.watch((t,e)=>e["getList".concat(this.point.toUpperCase())],t=>{t&&(this.result=this.result.concat(...t))}),this.$store.watch((t,e)=>e["getPointData".concat(this.point.toUpperCase())],(t,e)=>{e||"Мое местоположение"!==t.name||(this.select=this.items[0])})},watch:{layer(){this.layer||(this.search=null,this.select=null)},search(t){t&&t!==this.select&&this.querySelections(t)},select(){this.select&&""!==this.select||this.deleteMarker(this.point)}},methods:{querySelections(t){this.loading=!0,this.$store.dispatch("allList",{input:t,region_id:this.$store.getters.getRegionId,point:this.point}),setTimeout(()=>{this.items=this.result.filter(e=>(e.text||"").toLowerCase().indexOf((t||"").toLowerCase())>-1),this.loading=!1},500)},submitAddress(t){"Мое местоположение"===t.text?this.getPosition(this.point):t.id&&this.$store.dispatch("setPoint",{id:t.id,point:this.point})}}}),h=d,u=a("2877"),g=a("6544"),m=a.n(g),f=a("c6a6"),v=Object(u["a"])(h,l,p,!1,null,"d95ec50e",null),y=v.exports;m()(v,{VAutocomplete:f["a"]});var b={name:"App",components:{vInput:y},data:()=>({map:null,layerA:null,layerB:null,layerRoute:null,layerUser:null,watchID:null,prevDistance:null,counter:0}),mounted(){this.setMap(),this.getPosition("a"),this.$store.watch((t,e)=>e.getCurrentPosition,(t,e)=>{!e&&t?(this.$store.dispatch("setRegionId",{point:"".concat(t.position[1],", ").concat(t.position[0])}),this.$store.dispatch("setEachPoint",{whichPoint:t.point,point:[...t.position].reverse()}),this.$store.dispatch("setEachDataPoint",{name:"Мое местоположение",whichPoint:t.point,point:[...t.position].reverse()})):e&&t.point?(this.$store.dispatch("setEachPoint",{whichPoint:t.point,point:[...t.position].reverse()}),this.$store.dispatch("setEachDataPoint",{name:"Мое местоположение",whichPoint:t.point,point:[...t.position].reverse()})):e&&""===t.point&&(this.layerUser||this.setUserMarker(t.position),this.setViewMarker(t.position,12)),t&&(this.layerUser?this.moveUserMarker(new DG.latLng(t.position)):this.setUserMarker(t.position))}),this.$store.watch((t,e)=>e.getPointDataA,t=>{if(t){var e=[t.point[0],t.point[1]].reverse(),a="Пункт Отправления";if(this.equalAddress("b",t),this.setMarker(e,a,"".concat(t.name," - ").concat(a),"a"),this.setViewMarker(e,15),this.layerRoute){this.layerRoute.remove(),this.watchID&&this.counterID&&(navigator.geolocation.clearWatch(this.watchID),this.watchID=null);var i=this.$store.getters.getPointB,o=[i[0],i[1]].reverse(),s="Пункт назначения",r=this.$store.getters.getPointDataB;this.setMarker(o,s,"".concat(r.name," - ").concat(s),"b")}}}),this.$store.watch((t,e)=>e.getPointDataB,t=>{if(t){var e=[t.point[0],t.point[1]].reverse(),a="Пункт назначения";if(this.equalAddress("a",t),this.setMarker(e,a,"".concat(t.name," - ").concat(a),"b"),this.setViewMarker(e,15),this.layerRoute){this.layerRoute.remove(),this.watchID&&this.counterID&&(navigator.geolocation.clearWatch(this.watchID),this.watchID=null);var i=this.$store.getters.getPointA,o=[i[0],i[1]].reverse(),s="Пункт отправления",r=this.$store.getters.getPointDataA;this.setMarker(o,s,"".concat(r.name," - ").concat(s),"a")}}}),this.$store.watch((t,e)=>e.getRegionId,t=>{t&&this.$store.dispatch("setCityName",{id:t})}),this.$store.watch((t,e)=>e.getRouteData,t=>{t&&(this.displayRoute(t),this.watchPosition(),this.toggleCard(document.querySelector("#cardBtn")))})},methods:{equalAddress(t,e){var a=t.toUpperCase();this["layer".concat(a)]&&this.$store.getters["getPointData".concat(a)]&&this.$store.getters["getPointData".concat(a)].name===e.name&&(this.deleteMarker(t),this["layer".concat(a)]=null,this.$store.dispatch("setEachDataPoint",{whichPoint:t,name:null,point:null}),this.$store.dispatch("setEachPoint",{whichPoint:t,point:null}))},setMap(){this.map=DG.map("map",{center:[43.238949,76.889709],zoom:12,zoomControl:!1,fullscreenControl:!1,minZoom:8})},getPosition(t){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{var a=e.coords.latitude,i=e.coords.longitude;this.$store.dispatch("setCurrentPosition",{position:[a,i],point:t})})},watchPosition(){navigator.geolocation&&(this.watchID=navigator.geolocation.watchPosition(t=>{var e=t.coords.latitude,a=t.coords.longitude;this.$store.dispatch("setCurrentPosition",{position:[e,a],point:null}),this.updateCounter(this.$store.getters.getPointA,{position:[e,a]})},null,{enableHighAccuracy:!0,timeout:200}))},updateCounter(t,e){var a=this.getDistance(t,e);this.prevDistance?(this.counter+=Math.abs(a-this.prevDistance),this.prevDistance=a):(this.prevDistance=a,this.counter=0)},getDistance(t,e){if(t&&e.position){var a=e.position;a=[a[0],a[1]];var i=[t[0],t[1]].reverse(),o=DG.latLng(a),s=DG.latLng(i),r=s.distanceTo(o);return+(Math.floor(r/1e3*100)/100).toFixed(2)}return 0},setMarker(t,e,a,i){this.deleteMarker(i),this["layer".concat(i.toUpperCase())]=DG.marker(t,{title:e}).addTo(this.map).bindPopup(a)},deleteMarker(t){this["layer".concat(t.toUpperCase())]&&this["layer".concat(t.toUpperCase())].remove()},setViewMarker(t,e){this.map.setView(t,e)},moveUserMarker(t){this.layerUser.setLatLng(t)},setUserMarker(t){var e=DG.divIcon({html:'<div style="width: 50px; height: 50px; border-radius: 50%;background: rgba(15, 110, 193, 0.31);transform: translate(-30%, -30%); position: relative"><div style="width: 23px; height: 23px; border-radius: 13px; background: #fff;border: 2px solid #0f6ec1; position: absolute;top: 50%; left: 50%;transform: translate(-50%, -50%)"><img src="./img/car.png" width="12" style="position: absolute; top: 50%; left: 50%;transform: translate(-50%, -50%)" alt="M"></div></div>',className:"user-icon"});this.layerUser&&this.layerUser.remove(),this.layerUser=DG.marker([t[0],t[1]],{icon:e}).addTo(this.map).bindPopup("Вы здесь")},getRouteData(){var t=this.$store.getters.getPointA,e=this.$store.getters.getPointB;if(t&&e){var a=this.$store.getters.getPointDataA.name,i=this.$store.getters.getPointDataB.name;this.$store.dispatch("setRouteData",{city:this.$store.getters.getCityName,pointNameA:a,pointNameB:i,pointA:t,pointB:e}),this.startDistance=this.getDistance(this.$store.getters.getCurrentPosition,e)}},createIconPoint(t){var e="a"===t?"А":"Б";return DG.divIcon({html:'<div style="width: 20px; height: 20px; border-radius: 13px; background: #0f6ec1;border: 3px solid #fff; transform: translate(-3px, -3px); position: relative"><span style="position: absolute; top: 50%; left: 50%;transform: translate(-45%, -45%); font-family: sans-serif;'+'font-weight: 700; color: #fff; font-size: 10px;">'.concat(e)+"</span></div>",className:"my-point"})},displayRoute(t){var e={ignore:"#0f6ec1",pedestrian:"#626262",normal:"#ffc402","no-traffic":"#22aa01",fast:"#22aa01",slow:"#ed2301","slow-jams":"#851705"},a=5,i=DG.layerGroup(),o=DG.layerGroup(),s=DG.layerGroup(),r=DG.layerGroup(),n=t,c=this.createIconPoint("a"),l=this.createIconPoint("b"),p=n.waypoints[0],d=n.waypoints[1];DG.marker([p.projected_point.lat,p.projected_point.lon],{icon:c}).addTo(r),DG.marker([d.projected_point.lat,d.projected_point.lon],{icon:l}).addTo(r),this.layerA.remove(),this.layerB.remove(),n.begin_pedestrian_path&&(DG.Wkt.geoJsonLayer(n.begin_pedestrian_path.geometry.selection,{style:()=>({color:"#ffffff",weight:8})}).addTo(o),DG.Wkt.geoJsonLayer(n.begin_pedestrian_path.geometry.selection,{style:()=>({color:e.pedestrian,weight:a})}).addTo(r)),n.end_pedestrian_path&&(DG.Wkt.geoJsonLayer(n.end_pedestrian_path.geometry.selection,{style:()=>({color:"#ffffff",weight:8})}).addTo(o),DG.Wkt.geoJsonLayer(n.end_pedestrian_path.geometry.selection,{style:()=>({color:e.pedestrian,weight:a})}).addTo(r)),n.maneuvers.forEach(t=>{t.outcoming_path&&t.outcoming_path.geometry.forEach(t=>{DG.Wkt.geoJsonLayer(t.selection,{style:()=>({color:"#000",weight:11})}).addTo(s),DG.Wkt.geoJsonLayer(t.selection,{style:()=>({color:"#ffffff",weight:10})}).addTo(o),DG.Wkt.geoJsonLayer(t.selection,{style:()=>({color:e[t.color],weight:a})}).addTo(r)})}),s.addTo(i),o.addTo(i),r.addTo(i),this.layerRoute=i,this.layerRoute.addTo(this.map)},toggleCard(t){var e=null;t.target?t.target.classList.contains("v-icon")?e=t.target:t.target.classList.contains("v-btn__content")?e=t.target.firstElementChild:t.target.classList.contains("v-btn")&&(e=t.target.firstElementChild.firstElementChild):e=t,this.toggle(e,"bar")},toggle(t,e){t.closest(".".concat(e)).classList.contains("active")?(t.classList.remove("mdi-arrow-down"),t.classList.add("mdi-arrow-up"),t.closest(".".concat(e)).classList.remove("active")):(t.classList.remove("mdi-arrow-up"),t.classList.add("mdi-arrow-down"),t.closest(".".concat(e)).classList.add("active"))}}},w=b,P=(a("8be1"),a("7496")),D=a("8336"),k=a("b0af"),C=a("a75b"),_=a("553a"),x=a("132d"),A=a("b675"),$=Object(u["a"])(w,n,c,!1,null,"6bfbb556",null),L=$.exports;m()($,{VApp:P["a"],VBtn:D["a"],VCard:k["a"],VContent:C["a"],VFooter:_["a"],VIcon:x["a"],VInput:A["a"]});var I=a("f309");i["a"].use(I["a"]);var G=new I["a"]({}),M=a("2f62"),B=a("bc3a"),R=a.n(B),j={state:{listA:[],listB:[]},getters:{getListA(t){return t.listA},getListB(t){return t.listB}},mutations:{updateListA(t,e){t.listA=e},updateListB(t,e){t.listB=e}},actions:{allList(t,e){R.a.get("https://catalog.api.2gis.ru/2.0/geo/search",{headers:{Accept:"application/json"},params:{key:t.rootState.key,q:e.input,region_id:e.region_id}}).then(a=>{var i=[];200===a.data.meta.code&&(i=a.data.result.items.filter(t=>t.id).map(t=>({id:t.id,text:t.name}))),t.commit("updateList".concat(e.point.toUpperCase()),i)})}}},U=(a("466d"),{state:{pointA:null,pointB:null,pointDataA:null,pointDataB:null},getters:{getPointA(t){return t.pointA},getPointB(t){return t.pointB},getPointDataA(t){return t.pointDataA},getPointDataB(t){return t.pointDataB}},mutations:{updatePointA(t,e){t.pointA=e},updatePointB(t,e){t.pointB=e},updatePointDataA(t,e){t.pointDataA=e},updatePointDataB(t,e){t.pointDataB=e}},actions:{setPoint(t,e){R.a.get("https://catalog.api.2gis.ru/2.0/geo/get",{headers:{Accept:"application/json"},params:{key:t.rootState.key,id:e.id,fields:"items.geometry.selection"}}).then(a=>{if(200===a.data.meta.code){var i=/[+-]?\d+(\.\d+)?/g,o=a.data.result.items[0].geometry.selection;o=o.match(i).map(t=>parseFloat(t)),o.length>2&&(o=[o[0],o[1]]);var s=a.data.result.items[0];t.commit("updatePointData".concat(e.point.toUpperCase()),{name:s.name,point:o}),t.commit("updatePoint".concat(e.point.toUpperCase()),o)}})},setEachPoint(t,e){e.point?t.commit("updatePoint".concat(e.whichPoint.toUpperCase()),e.point):t.commit("updatePoint".concat(e.whichPoint.toUpperCase()),null)},setEachDataPoint(t,e){e.point||e.name?t.commit("updatePointData".concat(e.whichPoint.toUpperCase()),{name:e.name,point:e.point}):t.commit("updatePointData".concat(e.whichPoint.toUpperCase()),null)}}}),T=a("974a"),S={state:{regionId:null,isGlobal:null,regions:null,cityName:null},getters:{getRegionId(t){return t.regionId},isGlobal(t){return t.isGlobal},getRegions(t){return t.regions},getCityName(t){return t.cityName}},mutations:{updateRegionId(t,e){t.regionId=e},updateRegions(t,e){t.regions=e},updateCityName(t,e){t.cityName=e},updateIsGlobal(t,e){t.isGlobal=e}},actions:{setRegionId(t,e){R.a.get("https://catalog.api.2gis.ru/2.0/geo/search",{headers:{Accept:"application/json"},params:{key:t.rootState.key,point:e.point,fields:"items.region_id",radius:2e3}}).then(e=>{if(200===e.data.meta.code){var a=e.data.result.items.find(t=>t.region_id),i=a.region_id;t.commit("updateRegionId",i)}else t.commit("updateIsGlobal",!0)})},allRegions(t){R.a.get("https://catalog.api.2gis.ru/2.0/region/list",{headers:{Accept:"application/json"},params:{key:t.rootState.key}}).then(e=>{200===e.data.meta.code&&t.commit("updateRegions",e.data.result.items)})},setCityName(t,e){R.a.get("https://catalog.api.2gis.ru/2.0/region/get",{headers:{Accept:"application/json"},params:{key:t.rootState.key,id:e.id}}).then(e=>{if(200===e.data.meta.code){var a=e.data.result.items[0].name.toLowerCase();t.commit("updateCityName",Object(T["transliterate"])(a))}})}}},E={state:{routeData:null},getters:{getRouteData(t){return t.routeData}},mutations:{updateRouteData(t,e){t.routeData=e}},actions:{setRouteData(t,e){var a={locale:"ru",point_a_name:e.pointNameA,point_b_name:e.pointNameB,points:[{type:"pedo",x:e.pointA[0],y:e.pointA[1]},{type:"pedo",x:e.pointB[0],y:e.pointB[1]}],type:"jam"};R.a.post("https://catalog.api.2gis.ru/carrouting/4.0.0/".concat(e.city,"/"),a,{headers:{Accept:"application/json"},params:{key:t.rootState.key}}).then(e=>{e.data&&t.commit("updateRouteData",e.data.result[0])})}}},N={state:{currentPosition:null},getters:{getCurrentPosition(t){return t.currentPosition}},mutations:{updateCurrentPosition(t,e){t.currentPosition=e}},actions:{setCurrentPosition(t,e){t.commit("updateCurrentPosition",e)}}};i["a"].use(M["a"]);var O=new M["a"].Store({state:{key:"ruzrgk1901"},modules:{search:j,point:U,region:S,route:E,position:N}}),V=a("194a");o["c"].add(s["a"]),i["a"].component("font-awesome-icon",r["a"]),i["a"].config.productionTip=!1,new i["a"]({vuetify:G,DG:V,render:t=>t(L),store:O}).$mount("#app")},"8be1":function(t,e,a){"use strict";var i=a("0dfd"),o=a.n(i);o.a}});
//# sourceMappingURL=app.4389e807.js.map